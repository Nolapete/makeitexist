[
  {
    "model": "blog.category",
    "pk": 2,
    "fields": {
      "name": "DevOps",
      "slug": "devops"
    }
  },
  {
    "model": "blog.post",
    "pk": 2,
    "fields": {
      "title": "Streamlining Django Deployments: Building a Reusable Project Manager Script",
      "slug": "automating-django-deployments-reusable-shell-script",
      "content": "## Automating Django Deployments: A Reusable Shell Script\n\nManaging multiple Django projects on a single server can quickly become complex, especially when coordinating code pulls, migrations, static file collection, and service restarts (like uWSGI, Celery, and Apache/Nginx). Manual execution is error-prone and time-consuming.\n\nThe solution is a robust, reusable shell script that handles both full deployments and simple service restarts, making your workflow predictable and smooth.\n\nThis script was developed during a troubleshooting session for the `makeitexist` project to standardize operations across five different Django websites hosted on a single Linode VPS.\n\n### The Goal: A Single Source of Truth\n\nWe aimed to create one script capable of managing all projects on the server, handling two main actions:\n\n1.  **`deploy`**: Pull code, install dependencies, run migrations, collect static files, and restart services.\n2.  **`restart`**: Just restart all associated system services (web server, worker, beat).\n\nThe script was designed to accommodate specific naming conventions, such as using the first letter of the project name for the virtual environment directory (e.g., `m_env` for `makeitexist`).\n\n### The Final Script: `project_manager.sh`\n\nThis script uses standard Unix utilities, functions, and conditional logic (`case` statements and `if` checks) for maximum flexibility.\n\nSave the following code as `/var/www/project_manager.sh` on your server:\n\n```bash\n#!/bin/bash\n\n# Define global variables based on arguments $1 (project name) and $2 (action)\nPROJECT_NAME=$1\nACTION=$2\n\n# Configuration Variables\nPROJECT_DIR=\"/var/www/$PROJECT_NAME\"\n# Dynamically determine the VENV name (e.g., m_env for makeitexist)\nFIRST_LETTER=$(echo \"$PROJECT_NAME\" | cut -c 1)\nVENV_DIR=\"${FIRST_LETTER}_env\" \n\n# Service names for uWSGI, Apache, and Celery (must match systemd config)\nUWSGI_SERVICE_NAME=\"${PROJECT_NAME}.service\"\nAPACHE_SERVICE_NAME=\"apache2.service\"\nCELERY_WORKER_SERVICE=\"/etc/systemd/system/${PROJECT_NAME}_celery_worker.service\"\nCELERY_BEAT_SERVICE=\"/etc/systemd/system/${PROJECT_NAME}_celery_beat.service\"\n\n# --- Functions ---\n\n# Function to handle all service restarts\nrestart_services() {\n    echo \"--- Restarting services for $PROJECT_NAME ---\"\n    sudo systemctl daemon-reload\n\n    # Restart uWSGI and Apache (these are always required)\n    sudo systemctl restart $UWSGI_SERVICE_NAME \n    sudo systemctl restart $APACHE_SERVICE_NAME \n\n    # Conditionally restart Celery services if their files exist\n    if [ -f \"$CELERY_WORKER_SERVICE\" ]; then\n        echo \"Restarting Celery Worker...\"\n        sudo systemctl restart $(basename $CELERY_WORKER_SERVICE) # Use basename for systemctl command\n    else\n        echo \"Celery Worker service file not found. Skipping restart.\"\n    fi\n\n    if [ -f \"$CELERY_BEAT_SERVICE\" ]; then\n        echo \"Restarting Celery Beat...\"\n        sudo systemctl restart $(basename $CELERY_BEAT_SERVICE)\n    else\n        echo \"Celery Beat service file not found. Skipping restart.\"\n    fi\n\n    echo \"--- Restart complete ---\"\n}\n\n# Function to handle the full deployment process\ndeploy_project() {\n    echo \"--- Starting full deployment for $PROJECT_NAME ---\"\n    # Navigate, pull code, install deps\n    cd $PROJECT_DIR || { echo \"Error: Project directory not found at $PROJECT_DIR\"; exit 1; }\n    git pull origin master \n    source $VENV_DIR/bin/activate\n    pip install -r requirements.txt\n    python manage.py migrate --noinput \n    python manage.py collectstatic --noinput\n    deactivate\n    restart_services # Calls the conditional restart function\n    echo \"--- Deployment finished successfully for $PROJECT_NAME ---\"\n    echo \"NOTE: Remember to manually run loaddata if needed for initial fixtures.\"\n}\n\n# --- Main Logic (Argument Parsing) ---\n\nif [ \"$#\" -ne 2 ]; then\n    echo \"Usage: $0 <project_name> <deploy|restart>\"\n    echo \"Example (Full Deploy): $0 makeitexist deploy\"\n    echo \"Example (Just Restart): $0 makeitexist restart\"\n    exit 1\nfi\n\ncase \"$ACTION\" in\n    deploy)\n        deploy_project\n        ;;\n    restart)\n        restart_services\n        ;;\n    *)\n        echo \"Invalid action: $ACTION. Use 'deploy' or 'restart'.\"\n        exit 1\n        ;;\n\nesac\n```\n\n### How to Use the Script\n\n1.  **Save the file:** Place it in a shared directory like `/var/www/project_manager.sh`.\n2.  **Make it executable:**\n    ```bash\n    chmod +x /var/www/project_manager.sh\n    ```\n3.  **Ensure `sudoers` is configured:** Edit `/etc/sudoers` to allow your deployment user to run the `systemctl restart` commands without a password.\n4.  **Run a Full Deployment:**\n    ```bash\n    /var/www/project_manager.sh makeitexist deploy\n    ```\n5.  **Run a Simple Restart:**\n    ```bash\n    /var/www/project_manager.sh makeitexist restart\n    ```\n\nThis script provides a professional, repeatable, and robust way to manage your Django projects, turning a tedious manual process into a single, reliable command.",
      "pub_date": "2025-11-05T08:30:00Z",
      "author": 1,
      "category": 2,
      "is_published": true,
      "excerpt": "A reusable Bash script to automate Django deployments and service restarts across multiple projects on a single Linode server, handling uWSGI, Celery, and Apache seamlessly."
    }
  }
]
